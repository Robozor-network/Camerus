<html>

<head>
<meta http-equiv="Content-Language" content="cs">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1250">
<title>Camerus</title>
</head>

<body>

<p align="center"><font face="Arial"><font size="7">Robot CAMERUS<br>
</font><font size="4">Jak se dìlá robot na IstRobot<br>
</font><br>
<a href="mailto:kaklik@mlab.cz">kaklik@mlab.cz</a>; <a href="mailto:kakl@i.cz">
kakl@i.cz</a><br>
&nbsp;</font></p>
<p align="center"><a href="pic/image001.jpg">
<img border="0" src="pic/image001_small.jpg" xthumbnail-orig-image="pic/image001.jpg"></a></p>
<p align="left"><font face="Times New Roman">Tato dokumentace popisuje 
konstrukci robota Camerus, kterı byl zkonstruován pro soutì IstRobot pro 
kategorii Stopár (<a href="http://www.robotika.sk/contest/">http://www.robotika.sk/contest/</a>).
<br>
<br>
Snaili jsme se technickou dokumentaci pojmout ponìkud netradiènì. Kromì popisu 
finální verze robota zde naleznete chronologickı popis jeho vıvoje a popis všech 
slepıch ulièek. Doufáme, e takováto forma dokumentace bude mít pro naše 
následovníky vìtší hodnotu ne pouhı návod na zopakování konstrukce.<br>
&nbsp;</font></p>
<p align="left"><font face="Times New Roman" size="4"><b>Robot 3Orbis</b></font></p>
<p align="left"><font face="Times New Roman"><span lang="cs">Vıvoj robota 
Camerus zaèal pøed více jak dvìma roky vıvojem robota 3Orbis. Robot 3Orbis mìl 
mít novou revoluèní koncepci podvozku. Pouili jsme tøíkolı podvozek, kterı mìl 
dvì hnaná kola, kadé s&nbsp;nezávislım motorem a tøetí kolo, které mìlo øízené 
zatáèení. Jednalo se tedy o nonholonomní podvozek. Koncepci podvozku jsme 
nejdøíve ovìøovali se dvìma senzory na èáru, jako to mìly naši pøedchozí 
holonomní roboti. To moc nefungovalo a proto jsme pøidali další senzory, pomocí 
kterıch se diskrétnì nastavoval úhel zatáèecího koleèka.</span></font></p>
<p align="center"><font face="Times New Roman"><a href="pic/image003.jpg">
<img border="0" src="pic/image003_small.jpg" xthumbnail-orig-image="pic/image003.jpg"></a></font></p>
<p align="center"><font face="Times New Roman">Ob<span lang="en-us">r.</span>1: 
První pokusy s&nbsp;tøíkolım a tøímotorovım robotem<br>
<br>
<a href="pic/image005.jpg">
<img border="0" src="pic/image005_small.jpg" xthumbnail-orig-image="pic/image005.jpg"></a></font></p>
<p align="center"><font face="Times New Roman">Obr<span lang="en-us">.</span> 2: 
Baterie senzorù na èáru</font></p>
<p align="left"><font face="Times New Roman"><br>
Pøidáním dalších senzorù na èáru jsme se dostali do problémù s&nbsp;poètem vstupù 
pouitého procesoru (PIC16F88). Tento problém jsme vyøešili tak, e jsme na 
zpracování signálù ze senzorù na èáru pouili další samostatnı procesor. Toto 
øešení se však pozdìji neukázalo jako vıhodné, protoe ladit distribuovanı kód 
bylo øádovì obtínìjší a navíc se musela naprogramovat komunikace mezi 
procesory. Èasto se nám také stávalo, e jsme bìhem vıvoje do jednoho procesoru 
nahráli kód pro druhı procesor, co kupodivu obèas trvalo urèitou dobu, ne jsme 
na to pøišli.<br>
&nbsp;</font></p>
<p align="center"><font face="Times New Roman"><a href="pic/image007.jpg">
<img border="0" src="pic/image007_small.jpg" xthumbnail-orig-image="pic/image007.jpg"></a></font></p>
<p align="center"><font face="Times New Roman">Obr<span lang="en-us">. </span>3: 
Pøední náhon; pøidáno druhé patro na elektroniku<br>
&nbsp;</font></p>
<p align="left"><font face="Times New Roman">Pùvodní koncepce pøedpokládala 
hnaná kola vpøedu a zatáèecí kolo vzadu. Modeláøské servo však nedokázalo 
dostateènì rychle zatáèet, pøestoe bylo zpøevodováno do rychla pøevodem 1:2. 
Zmìnili jsme proto uspoøádání na hnanou nápravu vzadu a zatáèecí koleèko vpøedu. 
To nám umoòovalo „ostøe øezat zatáèky“, ale objevily se další problémy. 
Podvozek se v&nbsp;zatáèkách dostával do smyku a protoe hmotnost èidel byla 
nezanedbatelná, docházelo i k&nbsp;jeho naklápìní a následnì k&nbsp;falešnému signálu 
z&nbsp;èidel, protoe èidla nebyla drena v&nbsp;konstantní vzdálenosti od povrchu.<br>
<br>
Pro 3Orbise byla vysoustruena duralová kola, pro která bylo plánováno obutí „O“ 
krouky. To se pak ukázalo jako nepouitelné. „O“ krouky se nedokázaly udret 
v&nbsp;drákách na kolech. Pùvodní kola byla tedy nahrazena plastovımi z&nbsp;dìtské 
hraèky. Kola mìla menší prùmìr, co zlepšilo pøevodovı pomìr, kterı byl pro 
vyrobené pøevodovky 5:1. Jako obutí byly pouity ustøiené prsty z&nbsp;latexovıch 
rukavic pro domácnost. Jako obutí zatáèecího koleèka bylo pouito pryové 
tìsnìní 12x10x2. Na zatáèecí koleèko bylo obuto tak, e se jelo po hranì 
tìsnìní.</font></p>
<p align="center"><font face="Times New Roman">
<br>
<a href="pic/image009.jpg">
<img border="0" src="pic/image009_small.jpg" xthumbnail-orig-image="pic/image009.jpg"></a></font></p>
<p align="center"><font face="Times New Roman">Obr<span lang="en-us">.</span> 4: 
Robot 3Orbis. Zadní náhon a menší koleèka z&nbsp;autobusu od syna pana Hronka.<br>
Je vidìt èidlo na hledání hrany cihly.</font></p>
<p align="left"><font face="Times New Roman"><br>
Pro detekci a objídìní cihly byly na robotovi namontovány IR senzory. Jeden mìl 
detekovat pøekáku na dráze a zbylé dva mìly slouit pro její objetí. Objetí 
cihly pomocí IR senzorù jsme však nedokázali odladit. Objídìní nebylo 
spolehlivé a tak robot nakonec objídìl cihlu naslepo. <br>
Pøi soutìi se objevil neèekanı problém, kvùli kterému robot nakonec nedojel. 
Soutìní dráha je tvoøena dvìma deskami. Desky nejsou dokonale slícovány a tak 
mezi nimi vzniká tmavá mezera. Tato mezera byla na soutìní dráze pøelepena 
bílou lepicí páskou. Bohuel èidla na èáru, které robot pouíval, vyhodnocovala 
bílou lepicí pásku jako èernou (èidla pracují blízko ultrafialové oblasti). 
Tento problém by šel kompenzovat programovì, ale na soutìi se nepodaøilo 
program v&nbsp;èasové tísni správnì upravit. Robot tedy nakonec nedojel.<br>
<br>
Odhadovali jsme, e nám chybìl tak tıden na odladìní firmware, protoe v&nbsp;roce 
2006 u nás byla povodeò a ztratili jsme tak nejménì jeden mìsíc veèerù na 
programování. Nyní s&nbsp;odstupem èasu vidíme, e co se tıká objetí cihly, chybìlo 
mnohem více.<br>
&nbsp;</font></p>
<p align="left"><font face="Times New Roman" size="4"><b>Robot Laserus</b></font></p>
<p align="left"><font face="Times New Roman">Další verzí robota se shodnım 
podvozkem byl robot Laserus. Snahou bylo odstranit „tìká“ èidla pøedsunutá pøed 
robota a tak odstranit pøeklápìní v&nbsp;ostrıch zatáèkách. Øešením by bylo zvìtšení 
dosahu èidel na èáru tak, aby mohla bıt umístìna co nejblíe k&nbsp;ose otáèení 
robota. Zároveò by se tím sníila obvodová setrvaèná hmotnost robota. Znovu jsme 
pouili tøíkolı podvozek s&nbsp;jedním øízenım zatáèecím koleèkem, pøestoe na 
IstRobotu 2006 byla tato konfigurace diskutována a autoøi druhého robota 
s&nbsp;podobnou koncepcí se v&nbsp;diskusi vyjádøili, e to nebyl dobrı nápad, e robot 
pøi vìtších rychlostech má snahu se rozkmitávat. Øešení tohoto problému jsme 
vidìli ve zjemnìní snímání èáry tak, aby se preciznìji nastavovalo zatáèecí 
koleèko.<span lang="en-us"> </span>Napadlo nás pouít laserovou èteèku èárového 
kódu a skuteènì jsme postavili funkèního robota (viz Obrázek 5), kterı dokázal, 
ale pomalu, jezdit po èáøe. </font></p>
<p align="center"><font face="Times New Roman"><a href="pic/image011.jpg">
<img border="0" src="pic/image011_small.jpg" xthumbnail-orig-image="pic/image011.jpg"></a></font></p>
<p align="center"><font face="Times New Roman">Obr<span lang="en-us">.</span> 5: 
Robot Laserus. Na obrázku je vidìt èervená stopa LASERu.</font></p>
<p align="left"><font face="Times New Roman"> <br>
Problémy s&nbsp;touto konstrukcí byly dva. Pokud byl na dráze hrbol, tak se 
v&nbsp;dùsledku vibrací zmenšil rozkmit laseru, protoe laser je ve ètecím zaøízení 
rozmítáván mechanicky zrcátkem, které vibruje a velké stranové zrychlení pøi 
pøejetí hrbolu zpùsobovalo, e elektromagnetickı mechanismus, kterı pohybuje 
zrcátkem vypadl z&nbsp;rezonance. Tento problém by ovšem zøejmì šlo kompenzovat 
softwarem, protoe se èára èetla v&nbsp;obou smìrech pohybu zrcátka. Jednou jsme tedy 
dostali polohu èáry mìøenou z leva a jednou z prava.<br>
<br>
Druhı problém byl závanìjší. Protoe bylo pouito zaøízení na ètení èárového 
kódu, snímali jsme vlastnì polohu jedné èáry ve scanovaném prostoru. V&nbsp;prudké 
zatáèce však dochází k&nbsp;tomu, e èáru vidí snímaè šikmo a tak se relativnì 
zvìtšuje její tlouška. Vnitøní elektronika snímaèe vyhodnotila tento stav, jako 
e se nejedná o èárovı kód a èáru vyfiltrovala. To samozøejmì mìlo v&nbsp;ostré 
zatáèce fatální následky. Dále jsme touto cestou nepokraèovali, pøesto, e víme, 
e v&nbsp;závodì DARPA se èasto pouívají laserové dálkomìry. Na soutìních vozech je 
však vidìt, e konstruktéøi také mají problémy s&nbsp;odtlumením vibrací.<br>
&nbsp;</font></p>
<p align="left"><font face="Times New Roman" size="4"><b>Robot Camerus</b></font></p>
<p align="left"><font face="Times New Roman">Znovu se vynoøil nápad, pouít pro 
snímání èáry kameru. To u nás napadlo nìkolikrát, ale kdy jsme nápad 
analyzovali, vdy se ukázalo, e jednoduchım jednoèipovım mikropoèítaèem nelze 
zpracovávat obraz kamery. Druhım problémem je, e bìnì dostupné kamery mají 
snímkovı kmitoèet 50Hz, co se nám zdálo na snímání èáry pomalé.<span lang="en-us"> </span>
Pøesto jsme zakoupili jednu kameru a zaèali jsme osciloskopem testovat, co tak 
kamera vidí a jak by se to dalo zpracovat. Kupodivu jsme zjistili, e 
s&nbsp;procesorem na 20MHz stíháme naèíst jeden obrazovı øádek asi s&nbsp;polovièním 
rozlišením. To bylo povzbudivé a zamìøili jsme se tímto smìrem.<br>
Druhım problémem bylo, e kamera nesnímá kontrastní obraz. Jak se vypoøádat 
v&nbsp;jednoèipovém poèítaèi s&nbsp;tímto problémem, kdy jeho vıpoèetní vıkon staèí sotva 
na naètení øádku a ještì se musí poèítat regulace pro elektronickı diferenciál? 
(Pro zvolenou koncepci podvozku je nutné diferencovat otáèky motorù na hnanıch 
nápravách.)<br>
<br>
Problém jsme vyøešili nìèím, èemu jsme pracovnì zaèali øíkat „digitální 
komparátor“. Jednoduše jsme pomocí logickıch hradel provedli OR tøech nejvyšších 
bitù jasového signálu z&nbsp;kamery. Všechno co bylo pod 0x1F bylo tedy èerné a 
všechno nad bylo bílé. Expozici kamery pak bylo nutné nastavit tak, aby 
nejsvìtlejší èerná èára, byla ještì èerná. To se udìlalo snadno osciloskopem, 
ale pro závod bylo nutné vyvinout nìjakou strategii, jak robot provede urèení 
expozice. Øešením byla rutina „Expozimetr“, která postupnì zvyšuje expozièní èas 
a hledá ve snímku (samozøejmì, e v&nbsp;našem pøípadì na jedné øádce) èáru 
definované tloušky. Vychází se z&nbsp;toho, e nejdøíve pøi podexponování je èernı 
celı obrázek, pak se postupnì obrázek vyjasòuje, co je ovšem díky chybì 
apertury objektivu nerovnomìrné. Dalším zvyšováním èasu expozice se nakonec 
objeví èára správné tloušky, ta se pak dále ztenèuje a nakonec je snímek 
pøepálen a èára zmizí. Samozøejmì se pøedpokládalo, e na startu robot èáru vidí 
a ta je pøed ním pøiblinì uprostøed. <br>
<br>
První pokusy vypadaly velmi optimisticky, robot se drel èáry a vyjel jenom 
obèas. Zajímavé bylo, e robot dokázal jezdit jenom po dráze, kde nebyly zatáèky 
doleva! Protoe jsme nemìli k&nbsp;dispozici obraz z&nbsp;kamery, aby bylo moné 
zkontrolovat co kamera vidí, bylo nutné tento problém øešit pouhou úvahou. 
Napadlo nás, e mùe docházet k „vytrhávání obrazu“ na krajích snímku. 
Kompenzovalo se to tím, e se zahazovaly okraje øádku a skuteènì to pomohlo, 
robot spolehlivì, i kdy pomalu, sledoval èáru. To byl velkı úspìch, protoe 
kdyby nám nìkdo øekl pøed rokem, e to s&nbsp;kamerou a jednoèipovım poèítaèem jde, a 
e je to spolehlivé, asi by jsme mu nevìøili.<br>
<br>
Po prvotních úspìších jsme zkusili zrychlit jene to nefungovalo, robot vdy 
vypadl z&nbsp;dráhy, kdy se zatáèecí koleèko otoèilo o velkı úhel. Napadlo nás, e 
to mùe bıt zpùsobeno proudovımi špièkami, které zpùsobuje motor serva. Pro 
stabilizaci napájení pro elektroniku byl toti pouit lineární stabilizátor 
s&nbsp;velkım drop-outem. Proto jsme vyvinuli mìniè, kterı i pøi poklesu napìtí 
baterií o 2V dokázal udret napìtí pro øídící elektroniku a zejména kameru 
stabilní. Po tomto vylepšení u robot dosahoval pomìrnì slušné rychlosti a 
nejzajímavìjší bylo, e díky „velké“ rozlišovací schopnosti kamery (procesor 
dokázal rozlišit asi 50 bodù) byla jízda v&nbsp;zatáèkách velmi plynulá.<br>
<br>
Problém s&nbsp;tmou v&nbsp;tunelu byl vyøešen jednoduše tak, e si robot celou cestu 
svítil. Na osvìtlení dráhy byly pouity èervené LED. Nevíme, jaká barva pro 
osvìtlení dráhy je nejlepší, eventuelnì, jestli je lepší svítit bíle. S&nbsp;tím jsme 
u nestihli pøed soutìí experimentovat.<br>
<br>
Protoe pouitı procesor PIC16F876A neumí násobit a vùbec jeho vıpoèetní vıkon 
není omraèující (kdybychom ho ale mìli pøed lety, tak by jsme si urèitì 
nestìovali), byl celkem problém naprogramovat elektronickı diferenciál na 
hnanou nápravu. Nakonec se to vyøešilo procedurou „jakonásobení“, která 
kombinací rotací a podmínìného sèítání provádí rychle potøebnı vıpoèet 
s&nbsp;uspokojivou pøesností.</font></p>
<p align="center"><font face="Times New Roman"><a href="pic/image013.jpg">
<img border="0" src="pic/image013_small.jpg" xthumbnail-orig-image="pic/image013.jpg"></a></font></p>
<p align="center"><font face="Times New Roman">Obr<span lang="en-us">.</span> 6: 
Mìniè v&nbsp;krabièce od èaje a primitivní osvìtlení dráhy.<br>
&nbsp;</font></p>
<p align="center"><font face="Times New Roman"><a href="pic/image015.jpg">
<img border="0" src="pic/image015_small.jpg" xthumbnail-orig-image="pic/image015.jpg"></a></font></p>
<p align="center"><font face="Times New Roman">Obr<span lang="en-us">.</span> 7: 
Robot, pøítel èlovìka.</font></p>
<p align="left"><font face="Times New Roman">Zaèali jsme tedy testovat pro 
sledování èáry asi nejobtínìjší vìc, dlouhou rovinku a na konci pravoúhlou 
zatáèku. Pøi dalším zvyšování rychlosti zaèal robot v&nbsp;takové zatáèce vypadávat. 
Ne, e by pøímo vyjel a nevrátil se na dráhu, ale polomìr zatáèení byl menší ne 
polomìr zatáèky a hrozilo tedy, e v&nbsp;Bratislavì spadne ze stolu. Udìlali jsme 
pøedpoklad, e je to zpùsobeno pomalım snímkovım kmitoètem kamery, ne si robot 
staèil všimnout, e je zatáèka ostrá, zmizela mu èára ze zorného pole.<br>
<br>
Dalším problémem bylo, e pokud bylo nerovnomìrné osvìtlení dráhy, vypadával 
kameøe obraz. Kamera má sice AGC, ale samozøejmì, e je schopna kompenzovat 
rozdíly jasu jenom v&nbsp;urèitıch mezích. Kupodivu nebyl problém v&nbsp;tunelu, kde si 
robot svítí, ale velkı problém byl s&nbsp;denním svìtlem, pokud pøicházelo pouze 
z&nbsp;jednoho smìru.<br>
<br>
Konstrukèní øešení, které následovalo, bylo doplnìní dvou modrıch èidel po 
stranách robota na sledování èáry. Èidla byla umístìna tak, e vidìla èáru, a 
kdy èára byla mimo zorné pole kamery a uplatòovala se pouze v&nbsp;pøípadì, e 
kamera èáru nevidí. To velmi zvıšilo spolehlivost sledování èáry. Zároveò jsme 
tato èidla pouili pro opìtovné vyhledání èáry po objetí cihly, protoe jsme se 
báli pro tento úkol pouít kameru, protoe po dobu objídìní cihly kamera nevidí 
kontrastní obrázek (nevidí èáru) a díky AGC by mohla zaznamenat stín nebo špínu 
na trati jako èáru. <br>
<br>
Na objídìní cihly byl robot Camerus vybaven odometrií na pravém kole. Vyuili 
jsme otvorù ve vìtším kole pøevodovky a IR závory z&nbsp;tiskárny. Citlivost o<span lang="en-us">d</span>ometrie 
nebyla velká (4 impulzy na jednu otáèku koleèka (12,6mm)).<br>
&nbsp;</font></p>
<p align="left"><b><font face="Times New Roman" size="4">Jak jsme jeli „ladit“ 
do Vídnì</font></b></p>
<p align="left"><font face="Times New Roman">Vše potøebné bylo naprogramováno, 
robot sledoval èáru. Pøerušení nedìlalo problémy, prostì byl vıpadek obrazu a 
robot pokraèoval v&nbsp;pùvodním smìru pøed pøerušením. Cihla byla øešena pomocí 
odometrie. Takto vybaveni jsme odjeli do Vídnì na Robot Challenge 2007. Øekli 
jsme si, e to tam odladíme, protoe jsou tam jednodušší podmínky ne 
v&nbsp;Bratislavì (alespoò na první pohled, robot mùe bıt vìtší a tunel je také 
vìtší, take robot nemusí jet tak pøesnì).<br>
<br>
Rozhodnutí ladit robota na Robot Challenge se ukázalo jako správné. Podmínky 
toti byly nároèné. Bodové osvìtlení, dráha sloená z&nbsp;desek s&nbsp;mezerami, styl 
soutìe play-off.<br>
<br>
Camerus urèitì jezdil nejrychleji, ale nedokázal objet cihlu! Jednou se stalo, 
e uvidìl mezeru mezi deskami, podruhé mu zøejmì proklouzlo koleèko s&nbsp;odometrií, 
prostì katastrofa! Alespoò, e byl tøetí v&nbsp;paralelním slalomu, to jsme mu ale 
zavinili my, protoe jsme mu pøi zkoušení objetí cihly stáhli vıkon motorù a pak 
jsme na to zapomnìli. Za tøetí místo tedy nemohl robot, ale lidskı faktor.<br>
<br>
&nbsp;</font></p>
<p align="center"><font face="Times New Roman"><a href="pic/image017.jpg">
<img border="0" src="pic/image017_small.jpg" xthumbnail-orig-image="pic/image017.jpg"></a></font></p>
<p align="center"><font face="Times New Roman">Obr<span lang="en-us">.</span> 8: 
Robot Challenge 2007, Parallel Slalom. Robot Camerus na dráze èíslo 1. Na dráze 
jsou patrné stíny od bodového osvìtlení.<br>
&nbsp;</font></p>
<p align="center"><font face="Times New Roman"><a href="pic/image019.jpg">
<img border="0" src="pic/image019_small.jpg" xthumbnail-orig-image="pic/image019.jpg"></a><span lang="en-us">
</span><a href="pic/P3180028.JPG">
<img border="0" src="pic/P3180028_small.JPG" xthumbnail-orig-image="pic/P3180028.JPG"></a><br>
<br>
Obr<span lang="en-us">.</span> 9: Robot Camerus na Robot Challenge 2007. Robot 
nemá dostatek èidel na bezpeèné objetí pøekáky.<br>
&nbsp;</font></p>
<p align="left"><font face="Times New Roman">Jednoznaènì se ukázalo, e objídìt 
pøekáku „naslepo“ není dobrá strategie a zejména, pokud je odometrie na hnané 
nápravì.<br>
&nbsp;</font></p>
<p align="left"><font face="Times New Roman" size="4"><b>Co s&nbsp;cihlou?</b></font></p>
<p align="left"><font face="Times New Roman">Další vıvoj jsme vìnovali objídìní 
cihly za pomoci èidel. Jaká èidla ale pouít? Mìli jsme špatné zkušenosti s&nbsp;IR 
èidly s&nbsp;3Orbise a roboty s&nbsp;ultrazvukem jsme zase na minulıch roènících vidìli, 
e si spletli tunel s&nbsp;cihlou, pøípadnì nevidìli cihlu, pokud se k&nbsp;ní blíili 
zešikma.<br>
<br>
Nevìdìli jsme co s&nbsp;tím a tak jsme zaèali zkoušet. Mìøili jsme, co „vidí“ 
ultrazvuk a co rùzná optická èidla. Pøi mìøení se ukázaly všechny pøedpokládané 
problémy. Ultrazvuk vidí kde co, jenom ne cihlu, kdy je šikmo. IR snímaè vidí 
cihlu sice spolehlivì, ale stejnì dobøe jako velkou bílou zeï nìkolik metrù 
daleko. Nakonec byla pro cihlu zvolena kombinace sedmi senzorù. Skuteènì ètete 
dobøe, sedmi! Jeden IR senzor vpøedu na detekci pøiblíení se k&nbsp;cihle. Funguje 
na principu triangulace. IR vysílací dioda má úzkou hliníkovou trubièkou zúen 
paprsek, aby nedocházelo k&nbsp;jeho integraci na velké vzdálené ploše. Další dva 
senzory jsou mikrospínaèe na mechanickém nárazníku, kdyby se stalo, e 
triangulaèní èidlo cihlu pøehlédne. To se mùe stát v&nbsp;prudké zatáèce. Z&nbsp;boku 
jsou pak ultrazvukovı senzor a dálkomìr s&nbsp;èervenou LED. Tyto èidla udrují 
konstantní vzdálenost od cihly pøi jejím objídìní. K&nbsp;tomu ještì ji zmínìná 
odometrie na pravém koleèku, která zajišuje prudkou zatáèku doleva jakmile je 
cihla detekována a nakonec kompas, kterı zabraòuje, aby se robot vracel zpìt po 
trati (to se mùe stát, protoe mezi pøedním èidlem a boèními èidly je slepı 
úhel).<br>
<br>
Pøidání dalších èidel se neobešlo bez konstrukèních problémù. Boèní LED èidlo se 
ukázalo jako málo citlivé a bylo to zøejmì zpùsobeno tím, e se jedná o 
prùmyslové èidlo, které je normálnì napájeno napìtím 12 a 48V. S&nbsp;naším 
napájecím napìtím 7,2V a to ještì obèas, nebylo moc spokojeno. Byl tady pøidán 
další mìniè nahoru na 12V. Byl pouit mìniè ze staré síové karty.</font></p>
<p align="left"><font face="Times New Roman">Samostatnım konstrukèním problémem 
bylo umístìní kompasu. Nakonec musel bıt kompas umístìn nad všechny desky s 
elektronikou a musel bıt orientován tak, aby èidla byla pod úhlem 45<span lang="en">° 
k </span>ose robota.<span lang="en"> Pokud byla èidla v ose robota, byl kompas 
ovlivòován zbytkovım magnetickım polem v kovovıch (zejména eleznıch) èástech 
robota.</span><br>
&nbsp;</font></p>
<p align="left"><font face="Times New Roman" size="4"><b>Poslední weekend pøed 
soutìí</b></font></p>
<p align="left"><font face="Times New Roman">Pøidání kompasu na I2C sbìrnici si 
vyádalo pøeadresaci kamery, protoe kamera a kompas mìly na I2C sbìrnici 
stejnou adresu a adresa kompasu se nedala zmìnit. To kupodivu byl velkı problém, 
kterı jsme u øešili poslední weekend pøed soutìí a vynutil si tak zásadní 
zásah jako rozebrání objektivu kamery, co znamenalo peèlivé èištìní pouzdra 
èipu kamery, protoe pøípadné smítko na pouzdøe èipu by mìlo pøi soutìi fatální 
následky. Èip kamery sice pøeadresaci umí, ale bylo nutné pøipojit vıvod MULT 
(47) na <span lang="en-us">log_1 </span>a na to kupodivu na plošném spoji kamery 
nebylo pamatováno, pøesto, e na plošném spoji jsou plošky na odpory, které 
umoòují zmìnu adresy.<br>
&nbsp;</font></p>
<p align="center"><font face="Times New Roman"><a href="pic/image021.jpg">
<img border="0" src="pic/image021_small.jpg" xthumbnail-orig-image="pic/image021.jpg"></a></font></p>
<p align="center"><font face="Times New Roman">Obr<span lang="en-us">.</span> 
10: Propojka na PCB kamery umoòující její pøeadresaci.<br>
&nbsp;</font></p>
<p align="left"><font face="Times New Roman">Poslední weekend pøed soutìí nás 
napadlo ještì jednou projít seznam problémù, které jsme si poznamenali v&nbsp;prùbìhu 
loòské soutìe. Hned na zaèátku tam bylo: „Zkontrolovat, jestli neprokluzují 
koleèka na høídeli.“ Prokluzovaly. Zkusili jsme je pøilepit anaerobním lepidlem. 
Vısledek byl, e se zalepily høídelky do loisek a koleèka prokluzovala dál. 
Zkusili jsme je pøilepit epoxidem. Naneštìstí nám trochu epoxidu zøejmì nateklo 
do loisek a koleèka se zase utrhla. Poslední weekend pøed soutìí jsme tedy 
mìli zatuhlé pøevodovky a koleèka prokluzovala. Snaili jsme se do høídelek 
vyvrtat dírky a dát tam kolík, ale vrták vùbec nitridovanou ocel z&nbsp;CD mechanik 
nebral. Nakonec jsme do høídelek pouze vypilovali dráky a opìt jsme je zalili 
epoxidem. Jestli neprokluzují, jsme pro jistotu u nezkoušeli.<br>
<br>
Ještì bylo nutné znovu zabìhnout pøevodovky, to jsme dìlali pøes noc z&nbsp;pondìlí 
na úterı (IstRobot bıvá ve støedu a my tam obvykle jedeme v&nbsp;úterı dopoledne). 
Motory se toèily do rána do poslední chvíle pøed naloením robota do auta.<br>
&nbsp;</font></p>
<p align="left"><font face="Times New Roman" size="4"><b>Noc pøed soutìí</b></font></p>
<p align="left"><font face="Times New Roman">„Kdyby nebylo poslední noci, tak 
není ádnı projekt dokonèen.“ Odpoledne jsme pøijeli do Bratislavy na ubytovnu, 
rozloili dráhy a zaèali ladit poslední øádky programu. V&nbsp;našem pøípadì to mìlo 
bıt zpracování logu z&nbsp;jízdy.<br>
<br>
A vùbec to nejezdilo. Robot mìl malı vıkon v&nbsp;levotoèivé zatáèce, pøi objídìní 
cihly se dokonce obèas zastavil. No jasnì, øekli jsme si, jsou stále zatuhlé 
pøevodovky, zmìnili jsme pár konstant v&nbsp;programu a jakš takš to zase jezdilo. 
Situace se ale o pùlnoci zase zhoršila a zaèal smrdìt H-mùstek. Vymìnili jsme 
tedy H-mùstek a nepomohlo to. Vymìnili jsme tedy motor a pomohlo to! Prostì jsme 
neustálım ladìním programu a zkoušením znièili jeden motor! Vrátili jsme tedy do 
robota pùvodní H-mùstek (asi tak v&nbsp;jednu hodinu ráno) a zase to nejelo. Mìøením 
jsme pak zjistili dvì vìci, jednak byly pøes pájecí lak odizolovány zemnící 
šrouby na plošném spoji H-mùstku a tak všechen proud tekl pøes høebínkovı 
konektor a pak tam ještì byl zkrat pøes jeden tranzistor H-mùstku, take jeden 
motor nereverzoval. Pøedstavte si, e tyto závady byly vykompenzovány 
regulátorem v&nbsp;software a e s&nbsp;nimi byl Camerus na Robot Challenge tøetí!<br>
<br>
Pak u jenom staèilo doprogramovat tu logovací proceduru (pøepisovala pamì). A 
kolem páté hodiny ranní byl robot pøipraven na soutì.<br>
&nbsp;</font></p>
<p align="left"><font face="Times New Roman" size="4"><b>IstRobot 2007</b></font></p>
<p align="left"><font face="Times New Roman">IstRobot 2007 nás skuteènì 
pøekvapil, byla na nìm z&nbsp;našeho pohledu nejsloitìjší dráha, jakou jsme kdy 
vidìli. Extrémnì dlouhé pøerušení, navíc v&nbsp;inflexním bodì (to nás vùbec 
nenapadlo, e je moné), cihla hned za pravoúhlou zatáèkou (sotva robot vyjede 
ze zatáèky, bác, a je tu cihla), viz Obrázek 11. </font></p>
<p align="left">&nbsp;</p>
<p align="center"><font face="Times New Roman"><a href="pic/image023.jpg">
<img border="0" src="pic/image023_small.jpg" xthumbnail-orig-image="pic/image023.jpg"></a></font></p>
<p align="center"><font face="Times New Roman">Obr<span lang="en-us">.</span> 
11: IstRobot 2007 – tvar dráhy.</font></p>
<p align="left"><font face="Times New Roman">Potenciálním problémem byly 
magnetické stojánky na kterıch stály èidla èasomíry. Magnetické pole nad dráhou 
bylo díky nim znaènì nehomogenní (stojánek na Obr. 11 vlevo dole a dva stojánky 
na startu). Robot vyuíval kompas pouze u cihly, a zøejmì byl stojánek 
dostateènì daleko/blízko, e nakonec nevadil. Údaje z kompasu se zpracovávaly 
diferenènì, take nevadilo, e byla díky stojánkùm odchylka v celkové orientaci 
magnetického pole Zemì, podstatné bylo, aby nedocházelo k velkım zakøivením pole 
v oblasti cihly. K èemu, jak jsme zmìøili, èásteènì docházelo, ale software se 
s tím vypoøádal, kdy váil údaje ze všech èidel pøi objídìní pøekáky.</font></p>
<p align="left"><font face="Times New Roman">Obtínost trati se ukázala hned 
v&nbsp;první jízdì, Camerus vypadnul na pøerušení. V&nbsp;druhé jízdì jsme sníili vıkon 
motorù, zde ale zase hrozilo, e se robot nerozjede, pokud nìkde (napøíklad pøi 
objídìní cihly) vıraznì zpomalí. Robot jel plynuleji, pøesto vyjel v&nbsp;pøerušení 
(to dá rozum, protoe kopíroval tvar dráhy pøed pøerušením), vyhnul se tunelu, 
znovu našel dráhu (to fungovalo dobøe) a na podruhé projel. Byl to úspìch, ale 
velká èasová ztráta a navíc si robot špatnì zapamatoval dráhu pro další jízdu, 
protoe bloudil.</font></p>
<p align="left"><font face="Times New Roman">Programovali jsme místo obìda a 
nakonec jsme to pøerušení vyøešili. Prostì jsme zohlednili, e dráha za 
pøerušením mùe pokraèovat i na druhou stranu. Zní to jednoduše, ale úprava 
programu nebyla tak jednoduchá, viz soutìní verzi 
<a href="http://www.mlab.cz/WebSVN/listing.php?repname=MLAB&path=/Designs/ROBOTS/Camerus/sw/#_Designs_ROBOTS_Camerus_sw_">
firmware</a>.</font></p>
<p align="left"><font face="Times New Roman">Finálová jízda probìhla bez 
problémù, robot sice jel na ménì jak polovinu regulaèního rozsahu a bez našeho 
zásahu by se s&nbsp;dráhou dobøe nevypoøádal, ale jsme rádi, e dojel a nakonec 
stejnì za to nemohl robot, ale my, e jsme mu naprogramovali, e dráha za 
pøerušením nemùe vést na druhou stranu. Nakonec se podaøilo s&nbsp;robotem s&nbsp;èasem 
12,5s udìlat „rekord trati“ <span lang="en-us">;-)</span><br>
&nbsp;</font></p>
<p align="center"><font face="Times New Roman"><a href="pic/image025.jpg">
<img border="0" src="pic/image025_small.jpg" xthumbnail-orig-image="pic/image025.jpg"></a></font></p>
<p align="center"><font face="Times New Roman">Obr<span lang="en-us">.</span>12: 
Robot Camerus - finální verze robota.<br>
<br>
&nbsp;</font></p>
<p align="center"><a href="pic/index.2.gif">
<img border="0" src="pic/index.1.gif" xthumbnail-orig-image="pic/index.2.gif"></a></p>
<p align="center"><font face="Times New Roman">Obr<span lang="en-us">. </span>
13: Blokové schéma propojení modulù robota.<br>
&nbsp;</font></p>
<p align="left"><font face="Arial">Desky plošnıch spojù a popis jednotlivıch 
modulù robota naleznete na 
<a href="http://www.mlab.cz/">http://www.mlab.cz/</a> 
.<br>
&nbsp;</font></p>
<p align="left"><font face="Arial">Deska procesoru<br>
<a href="http://www.mlab.cz/WebSVN/listing.php?repname=MLAB&path=/Modules/PIC16F87x/#_Modules_PIC16F87x_">
http://www.mlab.cz/WebSVN/listing.php?repname=MLAB&amp;path=%2FModules%2FPIC16F87x%2F#_Modules_PIC16F87x_</a>
<br>
&nbsp;</font></p>
<p align="left"><font face="Arial">H-mùstky<br>
<a href="http://www.mlab.cz/WebSVN/listing.php?repname=MLAB&path=/Modules/HBRIDGE/#_Modules_HBRIDGE_">
http://www.mlab.cz/WebSVN/listing.php?repname=MLAB&amp;path=%2FModules%2FHBRIDGE%2F#_Modules_HBRIDGE_</a>
<br>
&nbsp;</font></p>
<p align="left"><font face="Arial">LEDbar<br>
<a href="http://www.mlab.cz/WebSVN/listing.php?repname=MLAB&path=/Modules/LEDbar/#_Modules_LEDbar_">
http://www.mlab.cz/WebSVN/listing.php?repname=MLAB&amp;path=%2FModules%2FLEDbar%2F#_Modules_LEDbar_</a><br>
&nbsp;</font></p>
<p align="left"><font face="Arial">Mìniè<br>
<a href="http://www.mlab.cz/WebSVN/listing.php?repname=MLAB&path=/Modules/PowerSupply/BATPOWER02A/#_Modules_PowerSupply_BATPOWER02A_">
http://www.mlab.cz/WebSVN/listing.php?repname=MLAB&amp;path=%2FModules%2FPowerSupply%2FBATPOWER02A%2F#_Modules_PowerSupply_BATPOWER02A_</a><br>
&nbsp;</font></p>
<p align="left"><font face="Arial">IR modulátor<br>
<a href="http://www.mlab.cz/WebSVN/listing.php?repname=MLAB&path=/Modules/TXIR/#_Modules_TXIR_">
http://www.mlab.cz/WebSVN/listing.php?repname=MLAB&amp;path=%2FModules%2FTXIR%2F#_Modules_TXIR_</a><br>
&nbsp;</font></p>
<p align="left"><font face="Arial">Osvìtlení dráhy<br>
<a href="http://www.mlab.cz/WebSVN/listing.php?repname=MLAB&path=/Designs/ROBOTS/Camerus/LEDpanel/#_Designs_ROBOTS_Camerus_LEDpanel_">
http://www.mlab.cz/WebSVN/listing.php?repname=MLAB&amp;path=%2FDesigns%2FROBOTS%2FCamerus%2FLEDpanel%2F#_Designs_ROBOTS_Camerus_LEDpanel_</a></font><br>
&nbsp;</p>
<p align="left"><font face="Arial">Univerzálka pro 7432<br>
<a href="http://www.mlab.cz/WebSVN/listing.php?repname=MLAB&path=/Modules/UNI/UNIDIL1601A/#_Modules_UNI_UNIDIL1601A_">
http://www.mlab.cz/WebSVN/listing.php?repname=MLAB&amp;path=%2FModules%2FUNI%2FUNIDIL1601A%2F#_Modules_UNI_UNIDIL1601A_</a><br>
&nbsp;</font></p>
<p align="left"><font face="Arial">Trimry<br>
<a href="http://www.mlab.cz/WebSVN/listing.php?repname=MLAB&path=/Modules/TRIMQUAD01A/#_Modules_TRIMQUAD01A_">
http://www.mlab.cz/WebSVN/listing.php?repname=MLAB&amp;path=%2FModules%2FTRIMQUAD01A%2F#_Modules_TRIMQUAD01A_</a><br>
&nbsp;</font></p>
<p align="left"><font face="Arial">Dokumentace k&nbsp;pouitému kamerovému èipu je na 
<a href="http://www.cmucam.org/attachment/wiki/Documentation/OV6620.PDF">
http://www.cmucam.org/attachment/wiki/Documentation/OV6620.PDF</a> 
.<br>
&nbsp;</font></p>
<p align="left"><font face="Arial">Dokumentace k&nbsp;US senzoru je na 
<a href="http://www.robot-electronics.co.uk/htm/srf08tech.shtml">
http://www.robot-electronics.co.uk/htm/srf08tech.shtml</a> .<br>
&nbsp;</font></p>
<p align="left"><font face="Arial">Dokumentace ke kompasu je na<span lang="en-us">
</span><a href="http://www.robot-electronics.co.uk/htm/cmps3doc.shtml">
http://www.robot-electronics.co.uk/htm/cmps3doc.shtml</a> .<br>
&nbsp;</font></p>
<p align="left"><font face="Arial">Dokumentace k&nbsp;robotu 3Orbis, ze kterého 
Camerus vyšel, je na<span lang="en-us">
</span>
<a href="http://www.mlab.cz/WebSVN/listing.php?repname=MLAB&path=/Designs/ROBOTS/3Orbis/#_Designs_ROBOTS_3Orbis_">
http://www.mlab.cz/WebSVN/listing.php?repname=MLAB&amp;path=%2FDesigns%2FROBOTS%2F3Orbis%2F#_Designs_ROBOTS_3Orbis_</a> 
.</font></p>
<p align="left"><font face="Arial"><span lang="en-us">Videoz</span>áznam, jak 
Camerus jezdil pøi soutìi IstRobot 2007:<br>
<a href="video/1.wmv">1. jízda</a>, <a href="video/2.wmv">2. jízda</a>,
<a href="video/3.wmv">3. jízda</a>.</font></p>

</body>

</html>
